(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class p{size=4;grid=[];score=0;tileIdCounter=0;constructor(){this.reset()}reset(){this.grid=Array(this.size).fill(null).map(()=>Array(this.size).fill(null)),this.score=0,this.tileIdCounter=0}getGrid(){return this.grid}getScore(){return this.score}setScore(e){this.score=e}getGridValues(){return this.grid.map(e=>e.map(t=>t?t.value:0))}restoreGrid(e){this.grid=e.map((t,i)=>t.map((s,r)=>s===0?null:this.createTile(i,r,s,!1)))}createTile(e,t,i,s=!0){return{id:this.tileIdCounter++,value:i,row:e,col:t,previousRow:null,previousCol:null,mergedFrom:null,isNew:s}}addRandomTile(){const e=[];for(let o=0;o<this.size;o++)for(let n=0;n<this.size;n++)this.grid[o][n]||e.push({row:o,col:n});if(e.length===0)return null;const{row:t,col:i}=e[Math.floor(Math.random()*e.length)],s=Math.random()<.9?2:4,r=this.createTile(t,i,s,!0);return this.grid[t][i]=r,r}prepareTiles(){for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){const i=this.grid[e][t];i&&(i.mergedFrom=null,i.isNew=!1,i.previousRow=i.row,i.previousCol=i.col)}}move(e){let t=!1,i=0,s=!1;const o={up:{row:-1,col:0},down:{row:1,col:0},left:{row:0,col:-1},right:{row:0,col:1}}[e],n=this.buildTraversals(o);for(const l of n.rows)for(const c of n.cols){const a=this.grid[l][c];if(!a)continue;const{furthest:d,next:h}=this.findFurthestPosition(l,c,o);if(h){const f=this.grid[h.row][h.col];if(f&&f.value===a.value&&!f.mergedFrom){const u=this.createTile(h.row,h.col,a.value*2,!1);u.mergedFrom=[a,f],u.previousRow=a.row,u.previousCol=a.col,this.grid[a.row][a.col]=null,this.grid[h.row][h.col]=u,a.row=h.row,a.col=h.col,i+=u.value,t=!0,u.value===2048&&(s=!0);continue}}(d.row!==l||d.col!==c)&&(this.grid[a.row][a.col]=null,this.grid[d.row][d.col]=a,a.row=d.row,a.col=d.col,t=!0)}return t&&(this.score+=i),{moved:t,scoreGain:i,winDetected:s}}buildTraversals(e){const t=Array.from({length:this.size},(s,r)=>r),i=Array.from({length:this.size},(s,r)=>r);return e.row===1&&t.reverse(),e.col===1&&i.reverse(),{rows:t,cols:i}}findFurthestPosition(e,t,i){let s=e,r=t,o=e+i.row,n=t+i.col;for(;this.isWithinBounds(o,n)&&!this.grid[o][n];)s=o,r=n,o+=i.row,n+=i.col;return{furthest:{row:s,col:r},next:this.isWithinBounds(o,n)?{row:o,col:n}:null}}isWithinBounds(e,t){return e>=0&&e<this.size&&t>=0&&t<this.size}movesAvailable(){for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){if(!this.grid[e][t])return!0;const i=this.grid[e][t];if(t<this.size-1){const s=this.grid[e][t+1];if(s&&s.value===i.value)return!0}if(e<this.size-1){const s=this.grid[e+1][t];if(s&&s.value===i.value)return!0}}return!1}}class w{gridElement;scoreElement;bestScoreElement;gameMessage;retryButton;undoButton;size=4;animationDuration=150;constructor(){this.gridElement=document.getElementById("grid"),this.scoreElement=document.getElementById("score"),this.bestScoreElement=document.getElementById("best-score"),this.gameMessage=document.getElementById("game-message"),this.retryButton=document.getElementById("retry"),this.undoButton=document.getElementById("undo"),this.setupGrid()}setupGrid(){this.gridElement.innerHTML="";for(let e=0;e<this.size*this.size;e++){const t=document.createElement("div");t.className="cell",this.gridElement.appendChild(t)}}updateScore(e,t){this.scoreElement.textContent=e.toString(),this.bestScoreElement.textContent=t.toString()}updateUndoButton(e){this.undoButton.disabled=e}clearTiles(){this.gridElement.querySelectorAll(".tile").forEach(t=>t.remove())}getTileClass(e){return e<=2048?`tile-${e}`:"tile-super"}getCellPosition(e,t){const i=e*this.size+t,s=this.gridElement.children[i];return{top:s.offsetTop,left:s.offsetLeft,size:s.offsetWidth}}render(e){const t=this.gridElement.querySelectorAll(".tile"),i=new Set;e.flat().forEach(s=>{s&&(i.add(s.id),s.mergedFrom?.forEach(r=>i.add(r.id)))}),t.forEach(s=>{const r=parseInt(s.getAttribute("data-id")||"-1",10);i.has(r)||s.remove()}),e.forEach(s=>{s.forEach(r=>{if(!r)return;r.mergedFrom&&r.mergedFrom.forEach(n=>{this.renderTile(n,r.row,r.col,!1,!1)});const o=!!r.mergedFrom;this.renderTile(r,r.row,r.col,r.isNew,o)})})}renderTile(e,t,i,s,r){let o=this.gridElement.querySelector(`[data-id="${e.id}"]`);const n=this.getCellPosition(t,i);if(!o){if(o=document.createElement("div"),o.setAttribute("data-id",e.id.toString()),o.className=`tile ${this.getTileClass(e.value)}`,o.textContent=e.value.toString(),o.style.width=`${n.size}px`,o.style.height=`${n.size}px`,s)o.style.top=`${n.top}px`,o.style.left=`${n.left}px`,o.classList.add("tile-new");else if(r)o.style.top=`${n.top}px`,o.style.left=`${n.left}px`,o.style.opacity="0",o.style.transform="scale(0)";else if(e.previousRow!==null&&e.previousCol!==null){const l=this.getCellPosition(e.previousRow,e.previousCol);o.style.top=`${l.top}px`,o.style.left=`${l.left}px`}else o.style.top=`${n.top}px`,o.style.left=`${n.left}px`;this.gridElement.appendChild(o),o.offsetHeight}o.style.top=`${n.top}px`,o.style.left=`${n.left}px`,r&&setTimeout(()=>{e.mergedFrom&&e.mergedFrom.forEach(l=>{const c=this.gridElement.querySelector(`[data-id="${l.id}"]`);c&&c.remove()}),o.style.opacity="1",o.style.transform="scale(1)",o.classList.add("tile-merged"),setTimeout(()=>o.classList.remove("tile-merged"),250)},this.animationDuration)}showInvalidMoveAnimation(e){const t=document.querySelector(".game-container");t.classList.remove("shake-left","shake-right","shake-up","shake-down"),t.offsetHeight,t.classList.add(`shake-${e}`),setTimeout(()=>t.classList.remove(`shake-${e}`),200)}showGameMessage(e,t,i){const s=this.gameMessage.querySelector("p");s.textContent=e,t?(this.retryButton.textContent="Keep Playing",this.retryButton.onclick=()=>i(!0)):(this.retryButton.textContent="Try Again",this.retryButton.onclick=()=>i(!1)),this.gameMessage.classList.add("active")}hideGameMessage(){this.gameMessage.classList.remove("active")}}class m{static BEST_SCORE_KEY="2048-best-score";static THEME_KEY="2048-theme";static getBestScore(){const e=localStorage.getItem(this.BEST_SCORE_KEY);return e?parseInt(e,10):0}static saveBestScore(e){localStorage.setItem(this.BEST_SCORE_KEY,e.toString())}static getTheme(){return new URLSearchParams(window.location.search).get("theme")||localStorage.getItem(this.THEME_KEY)||"neon"}static saveTheme(e){localStorage.setItem(this.THEME_KEY,e);const t=new URL(window.location.href);e==="neon"?t.searchParams.delete("theme"):t.searchParams.set("theme",e),window.history.replaceState({},"",t)}static updateUrlState(e,t){if(!t)return;const i=new URL(window.location.href);i.searchParams.set("state",e),window.history.replaceState({},"",i)}}class y{constructor(e,t,i){this.onMove=e,this.onUndo=t,this.gridElement=i,this.setupEventListeners()}touchStartX=0;touchStartY=0;minSwipeDistance=50;setupEventListeners(){document.addEventListener("keydown",e=>this.handleKeyDown(e)),this.gridElement.addEventListener("touchstart",e=>{this.touchStartX=e.touches[0].clientX,this.touchStartY=e.touches[0].clientY},{passive:!0}),this.gridElement.addEventListener("touchmove",e=>{e.preventDefault()},{passive:!1}),this.gridElement.addEventListener("touchend",e=>{if(!this.touchStartX||!this.touchStartY)return;const t=e.changedTouches[0].clientX,i=e.changedTouches[0].clientY,s=t-this.touchStartX,r=i-this.touchStartY;Math.abs(s)>Math.abs(r)?Math.abs(s)>this.minSwipeDistance&&this.onMove(s>0?"right":"left"):Math.abs(r)>this.minSwipeDistance&&this.onMove(r>0?"down":"up")},{passive:!0})}handleKeyDown(e){if((e.key==="z"||e.key==="Z")&&(e.ctrlKey||e.metaKey||!e.shiftKey)){e.preventDefault(),this.onUndo();return}let t=null;switch(e.key){case"ArrowUp":case"w":case"W":t="up";break;case"ArrowDown":case"s":case"S":t="down";break;case"ArrowLeft":case"a":case"A":t="left";break;case"ArrowRight":case"d":case"D":t="right";break}t&&(e.preventDefault(),this.onMove(t))}}class v{engine;renderer;history=[];maxHistoryLength=50;isAnimating=!1;gameOver=!1;hasWon=!1;keepPlaying=!1;bestScore=0;debugMode=!1;constructor(){this.engine=new p,this.renderer=new w,this.bestScore=m.getBestScore();const e=document.getElementById("theme"),t=m.getTheme();e.value=t,this.applyTheme(t),e.addEventListener("change",i=>{const s=i.target.value;this.applyTheme(s),m.saveTheme(s),this.renderer.render(this.engine.getGrid()),e.blur()}),document.getElementById("new-game")?.addEventListener("click",()=>this.newGame()),document.getElementById("undo")?.addEventListener("click",()=>this.undo()),new y(i=>this.handleMove(i),()=>this.undo(),document.getElementById("grid")),this.initFromUrl()}applyTheme(e){document.body.className="",e!=="classic"&&document.body.classList.add(`theme-${e}`)}initFromUrl(){const e=new URLSearchParams(window.location.search);this.debugMode=e.get("debug")==="true";const t=e.get("state");t?this.loadStateFromString(t):this.newGame()}loadStateFromString(e){try{const[t,i]=e.split("-"),s=parseInt(t,36),r=[];for(let o=0;o<4;o++){r[o]=[];for(let n=0;n<4;n++){const l=parseInt(i[o*4+n],16);r[o][n]=l===0?0:Math.pow(2,l)}}this.engine.restoreGrid(r),this.engine.setScore(s),this.history=[],this.gameOver=!1,this.hasWon=!1,this.keepPlaying=!1,this.updateUI()}catch{this.newGame()}}newGame(){this.engine.reset(),this.history=[],this.gameOver=!1,this.hasWon=!1,this.keepPlaying=!1,this.renderer.hideGameMessage(),this.renderer.clearTiles(),this.engine.addRandomTile(),this.engine.addRandomTile(),this.updateUI()}handleMove(e){if(this.isAnimating||this.gameOver||this.hasWon&&!this.keepPlaying)return;this.saveState(),this.engine.prepareTiles();const{moved:t,winDetected:i}=this.engine.move(e);t?(i&&(this.hasWon=!0),this.isAnimating=!0,this.renderer.render(this.engine.getGrid()),setTimeout(()=>{const s=this.engine.addRandomTile();s&&this.renderer.renderTile(s,s.row,s.col,!0,!1),this.debugMode&&m.updateUrlState(this.encodeState(),!0),setTimeout(()=>{this.isAnimating=!1,this.engine.movesAvailable()?this.hasWon&&!this.keepPlaying&&this.renderer.showGameMessage("You Win!",!0,r=>this.handleRetry(r)):(this.gameOver=!0,this.renderer.showGameMessage("Game Over!",!1,r=>this.handleRetry(r)))},100)},150),this.engine.getScore()>this.bestScore&&(this.bestScore=this.engine.getScore(),m.saveBestScore(this.bestScore)),this.renderer.updateScore(this.engine.getScore(),this.bestScore)):(this.history.pop(),this.renderer.updateUndoButton(this.history.length===0),this.renderer.showInvalidMoveAnimation(e))}handleRetry(e){e?(this.keepPlaying=!0,this.renderer.hideGameMessage()):this.newGame()}undo(){if(this.history.length===0||this.isAnimating)return;const e=this.history.pop();this.engine.restoreGrid(e.grid),this.engine.setScore(e.score),this.gameOver=!1,this.renderer.hideGameMessage(),this.updateUI()}saveState(){this.history.push({grid:this.engine.getGridValues(),score:this.engine.getScore()}),this.history.length>this.maxHistoryLength&&this.history.shift(),this.renderer.updateUndoButton(!1)}updateUI(){this.renderer.updateScore(this.engine.getScore(),this.bestScore),this.renderer.updateUndoButton(this.history.length===0),this.renderer.render(this.engine.getGrid())}encodeState(){const e=this.engine.getGridValues();let t="";return e.flat().forEach(i=>{t+=(i===0?0:Math.log2(i)).toString(16)}),this.engine.getScore().toString(36)+"-"+t}}document.addEventListener("DOMContentLoaded",()=>new v);
//# sourceMappingURL=index-d7ORSDgP.js.map
